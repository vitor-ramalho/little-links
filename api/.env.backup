# Configurações otimizadas baseadas nos recursos do servidor
DATABASE_HOST=localhost
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=postgres
DATABASE_NAME=little_link
DB_POOL_SIZE=40

# JWT
JWT_SECRET=your_jwt_secret_change_in_production
JWT_EXPIRATION=24h

# App
PORT=3000
NODE_ENV=development
BASE_URL=http://localhost:3000

# Vertical Scaling Options
NODE_OPTIONS="--max-old-space-size=4096"
ENABLE_MONITORING=true
MONITORING_INTERVAL=60000

echo -e "Núcleos de CPU: "
echo -e "Memória Total: GB"
echo -e "Memória Disponível: GB"

# Recomendações baseadas nos recursos disponíveis
if [  -lt 4 ]; then
    echo -e "⚠️  Aviso: Este servidor tem menos de 4 núcleos. A performance pode ser limitada."
    NODE_HEAP="2048"
elif [  -lt 8 ]; then
    echo -e "✅ O servidor tem um número adequado de núcleos para escalabilidade vertical moderada."
    NODE_HEAP="4096"
else
    echo -e "✅ O servidor tem um excelente número de núcleos para escalabilidade vertical."
    NODE_HEAP="8192"
fi

if [  -lt 8 ]; then
    echo -e "⚠️  Aviso: Este servidor tem menos de 8GB de RAM. A performance pode ser limitada."
    DB_POOL_SIZE=20
elif [  -lt 16 ]; then
    echo -e "✅ O servidor tem memória adequada para escalabilidade vertical moderada."
    DB_POOL_SIZE=40
else
    echo -e "✅ O servidor tem excelente quantidade de memória para escalabilidade vertical."
    DB_POOL_SIZE=80
fi

echo ""
echo -e "Configurando aplicação para escalabilidade vertical..."

# Verifica se está executando localmente ou em Docker
if ping -c 1 postgres &> /dev/null; then
    echo -e "Executando em ambiente Docker, host 'postgres' encontrado"
    DB_HOST="postgres"
else
    echo -e "Executando localmente, usando 'localhost' para banco de dados"
    DB_HOST="localhost"
fi

# Cria arquivo .env com configurações otimizadas
cd api
cat > .env << EOF
# Configurações otimizadas baseadas nos recursos do servidor
DATABASE_HOST=
DATABASE_PORT=5432
DATABASE_USERNAME=postgres
DATABASE_PASSWORD=postgres
DATABASE_NAME=little_link
DB_POOL_SIZE=

# JWT
JWT_SECRET=your_jwt_secret_change_in_production
JWT_EXPIRATION=3600

# App
PORT=3000
NODE_ENV=production
BASE_URL=http://localhost:3000

# Vertical Scaling Options
NODE_OPTIONS="--max-old-space-size=4096"
ENABLE_MONITORING=true
MONITORING_INTERVAL=30000
